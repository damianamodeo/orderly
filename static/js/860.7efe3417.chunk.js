"use strict";(self.webpackChunkorderly=self.webpackChunkorderly||[]).push([[860],{6860:function(e,n,t){t.r(n),t.d(n,{Settings:function(){return w}});var r=t(3667),o=t(3327),c=t(2076),s=t(7426),i=t(6435),l=t.n(i),a=t(5834);l().vfs=a.I.vfs;var u=function(e){return[Object.keys(e[1])].concat(e).map((function(e){return Object.values(e).toString()})).join("\r")},d=function(e,n){r.db.open().then((function(){!function(e,n,t,r){var o={},c=[n];if(0===c.size)r(null,"csv"===t?u(o[n]):JSON.stringify(o));else{var s=Array.from(c),i=e.transaction(s,"readonly");i.onerror=function(e){return r(e,null)},s.forEach((function(e){var c=[];i.objectStore(e).openCursor().onsuccess=function(i){var l=i.target.result;l?(c.push(l.value),l.continue()):(o[e]=c,s.length===Object.keys(o).length&&r(null,"csv"===t?u(o[n]):JSON.stringify(o)))}}))}}(r.db.backendDB(),e,n,(function(e,t){if(e)console.error(e);else{var r=new Date,o=String(r.getDate()).padStart(2,"0"),c=String(r.getMonth()+1).padStart(2,"0"),s=r.getFullYear(),i=new Blob([t],"csv"===n?{"text/csv":[".csv"]}:{"application/json":[".json"]}),l=URL.createObjectURL(i),a=Object.assign(document.createElement("a"),{href:l,style:"display:none",download:"publishers "+s+"-"+c+"-"+o+"."+n});document.body.appendChild(a),a.click(),URL.revokeObjectURL(l),a.remove()}}))})).catch((function(e){console.error("Could not connect. "+e)}))},f=t(2841),h=t(9328),p=t(184),v=function(e){var n=e.action,t=e.children;return(0,p.jsx)("div",{className:"dark:bg-buttonD w-56 text-center bg-button p-2 text-white dark:text-black m-auto",onClick:n,children:t})},b=t(1514),g=t(885),x=t(2791),j=function(e){var n=e.addStyle,t=e.children;return(0,p.jsx)("span",{className:"inline-block align-baseline dark:text-white "+n,children:t})},m=function(e){var n=e.id,t=(e.label,e.helpText),r=e.types,o=(0,x.useState)(t),c=(0,g.Z)(o,2),s=c[0],i=c[1];return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("input",{id:n,type:"file",accept:r,hidden:"hidden",onChange:function(e){i(e.target.value.match(/[/\\]([\w\d\s.\-()]+)$/)[1])}}),(0,p.jsxs)("div",{className:"my-3 flex flex-col content-center gap-5 text-center",children:[(0,p.jsx)(v,{action:function(){document.getElementById(n).click()},children:"Choose File"}),(0,p.jsx)(j,{children:s})]})]})},y=t(7201);var k=function(e,n,t,r){var o=new Set(e.objectStoreNames);if(0===o.size)r(null);else{var c,s=Array.from(o),i=e.transaction(s,"readwrite");i.onerror=function(e){return alert("cb(event)")};var l=c="text/csv"===t?JSON.parse('{"publishers": '.concat(function(e){for(var n=e.split("\r"),t=[],r=n[0].split(","),o=1;o<n.length;o++){for(var c={},s=n[o].split(","),i=0;i<r.length;i++)"lastName"===r[i]?c[r[i]]=(0,y.L)(s[i]):"id"===r[i]||"familyHead"===r[i]?c[r[i]]=parseInt(s[i]):c[r[i]]=s[i];t.push(c)}return JSON.stringify(t)}(n),"}")):JSON.parse(n);console.log(c),Object.keys(l).forEach((function(e){s.includes(e)||delete l[e]})),0===Object.keys(l).length&&r(null),s.forEach((function(e){var n=0,t=Array.from(l[e]||[]);l[e]&&t.length>0?t.forEach((function(t){var o=i.objectStore(e).add(t);o.onsuccess=function(){++n===l[e].length&&(delete l[e],0===Object.keys(l).length&&r(null))},o.onerror=function(e){console.log(e)}})):l[e]&&(delete l[e],0===Object.keys(l).length&&r(null))}))}},S=function(e){var n=document.querySelector("#import-stores").files[0],t=new FileReader;t.onloadend=function(){console.log(n.type),function(e,n,t){var r=[n],o=r.size;if(0===o)t(null);else{var c=Array.from(r),s=e.transaction(c,"readwrite");s.onerror=function(e){return t(e)};var i=0;c.forEach((function(e){s.objectStore(e).clear().onsuccess=function(){++i===o&&t(null)}}))}}(r.db.backendDB(),e),k(r.db.backendDB(),t.result,n.type,(function(e){console.log(e)}))},t.readAsText(n)},O=t(5125),w=function(){(0,o.useLiveQuery)((function(){return r.db.publishers.orderBy("[lastName+firstName]").toArray()}));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.h,{headerLeft:(0,p.jsx)("div",{}),title:(0,p.jsx)(h.X,{children:"Settings"}),headerRight:(0,p.jsx)("div",{className:"text-header text-primary"})}),(0,p.jsxs)(s.V,{bgColor:"bg-bgLightest dark:bg-black ",children:[(0,p.jsxs)(f.Z,{children:[(0,p.jsx)(b.o,{children:"Export Congregation"}),(0,p.jsxs)("div",{className:"my-3 flex flex-col content-center gap-8",children:[(0,p.jsx)(v,{action:function(){!function(){var e=new O.ZP;e.text("Hello world!",10,10),e.save("a4.pdf")}()},children:"PDF"}),(0,p.jsx)(v,{action:function(){d("publishers","ord")},children:"ORD"}),(0,p.jsx)(v,{action:function(){d("publishers","csv")},children:"CSV"})]})]}),(0,p.jsxs)(f.Z,{children:[(0,p.jsx)(b.o,{children:"Import Congregation"}),(0,p.jsxs)("div",{className:"my-3 flex flex-col content-center gap-3",children:[(0,p.jsx)(m,{id:"import-stores",label:"",helpText:"Select a .csv or .ord file",types:".ord,.csv"}),(0,p.jsx)(v,{action:function(){S("publishers")},children:"Import"})]})]})]})]})}}}]);
//# sourceMappingURL=860.7efe3417.chunk.js.map