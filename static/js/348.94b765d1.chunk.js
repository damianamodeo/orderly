"use strict";(self.webpackChunkorderly=self.webpackChunkorderly||[]).push([[348],{348:function(e,t,n){n.r(t),n.d(t,{Settings:function(){return m}});var r=n(667),o=n(327),i=n(76),a=n(426),c=n(435),s=n.n(c),l=n(834);s().vfs=l.I.vfs;var u=function(e){return[Object.keys(e[1])].concat(e).map((function(e){return Object.values(e).toString()})).join("\r")},d=function(e,t){r.db.open().then((function(){!function(e,t,n,r){var o={},i=[t];if(0===i.size)r(null,"csv"===n?u(o[t]):JSON.stringify(o));else{var a=Array.from(i),c=e.transaction(a,"readonly");c.onerror=function(e){return r(e,null)},a.forEach((function(e){var i=[];c.objectStore(e).openCursor().onsuccess=function(c){var s=c.target.result;s?(i.push(s.value),s.continue()):(o[e]=i,a.length===Object.keys(o).length&&r(null,"csv"===n?u(o[t]):JSON.stringify(o)))}}))}}(r.db.backendDB(),e,t,(function(e,n){if(e)console.error(e);else{var r=new Date,o=String(r.getDate()).padStart(2,"0"),i=String(r.getMonth()+1).padStart(2,"0"),a=r.getFullYear(),c=new Blob([n],"csv"===t?{"text/csv":[".csv"]}:{"application/json":[".json"]}),s=URL.createObjectURL(c),l=Object.assign(document.createElement("a"),{href:s,style:"display:none",download:"publishers "+a+"-"+i+"-"+o+"."+t});document.body.appendChild(l),l.click(),URL.revokeObjectURL(s),l.remove()}}))})).catch((function(e){console.error("Could not connect. "+e)}))},f=n(201);var h=function(e,t,n,r){var o=new Set(e.objectStoreNames);if(0===o.size)r(null);else{var i,a=Array.from(o),c=e.transaction(a,"readwrite");c.onerror=function(e){return alert("cb(event)")};var s=i="text/csv"===n?JSON.parse('{"publishers": '.concat(function(e){for(var t=e.split("\r"),n=[],r=t[0].split(","),o=1;o<t.length;o++){for(var i={},a=t[o].split(","),c=0;c<r.length;c++)"lastName"===r[c]?i[r[c]]=(0,f.L)(a[c]):"id"===r[c]||"familyHead"===r[c]?i[r[c]]=parseInt(a[c]):i[r[c]]=a[c];n.push(i)}return JSON.stringify(n)}(t),"}")):JSON.parse(t);console.log(i),Object.keys(s).forEach((function(e){a.includes(e)||delete s[e]})),0===Object.keys(s).length&&r(null),a.forEach((function(e){var t=0,n=Array.from(s[e]||[]);s[e]&&n.length>0?n.forEach((function(n){var o=c.objectStore(e).add(n);o.onsuccess=function(){++t===s[e].length&&(delete s[e],0===Object.keys(s).length&&r(null))},o.onerror=function(e){console.log(e)}})):s[e]&&(delete s[e],0===Object.keys(s).length&&r(null))}))}},x=function(e){var t=document.querySelector("#import-store").files[0],n=new FileReader;n.onloadend=function(){console.log(t.type),function(e,t,n){var r=[t],o=r.size;if(0===o)n(null);else{var i=Array.from(r),a=e.transaction(i,"readwrite");a.onerror=function(e){return n(e)};var c=0;i.forEach((function(e){a.objectStore(e).clear().onsuccess=function(){++c===o&&n(null)}}))}}(r.db.backendDB(),e),h(r.db.backendDB(),n.result,t.type,(function(e){console.log(e)}))},n.readAsText(t)},g=n(184),b=function(e){var t=e.id,n=e.label,r=e.helpText,o=e.types;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-900 xxx-dark:text-gray-300",htmlFor:t,children:n}),(0,g.jsx)("input",{className:"block w-full cursor-pointer  border border-gray-300 bg-gray-50 text-sm text-gray-900 focus:outline-none xxx-dark:border-gray-600 xxx-dark:bg-gray-700 xxx-dark:text-gray-400 xxx-dark:placeholder-gray-400","aria-describedby":"file_input_help",id:t,type:"file",accept:o}),(0,g.jsx)("p",{className:"mt-1 text-sm text-gray-500 xxx-dark:text-gray-300",id:"file_input_help",children:r})]})},p=function(){return(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("div",{className:"bg-white m-4 h-32 p-2 text-center relative",children:["Import Congregation",(0,g.jsx)(b,{id:"import-store",label:"",helpText:"",types:".ord,.csv"}),(0,g.jsx)("div",{className:"absolute right-4 w-fit bg-bg p-2 text-right",onClick:function(){x("publishers")},children:"Import"})]})})},m=function(){var e=(0,o.useLiveQuery)((function(){return r.db.publishers.orderBy("[lastName+firstName]").toArray()}));return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(i.h,{headerLeft:(0,g.jsx)("div",{}),title:(0,g.jsx)("div",{className:"text-header font-bold",children:"Settings"}),headerRight:(0,g.jsx)("div",{className:"text-header text-primary"})}),(0,g.jsxs)(a.V,{bgColor:"bg-bgLightest ",children:[(0,g.jsx)("div",{className:"m-4 bg-white p-4 text-center",onClick:function(){!function(e){var t,n={content:[],pageMargins:10};null===e||void 0===e||e.filter((function(e){return!e.familyHead||e.id===e.familyHead})).forEach((function(r){return(t=[{svg:'<svg height="20" width="580"><line x1="0" y1="18" x2="580" y2="18" stroke="#4a6da7" style="stroke-width:2" /></svg>'},{columns:[{text:r.lastName.toUpperCase(),fontSize:18,bold:!0,width:"25%"},{text:r.homePhone,width:"25%"},{text:"".concat(r.unitNumber?"".concat(r.unitNumber,"/"):"").concat(r.houseNumber," ").concat(r.street,", ").concat(r.suburb),fontSize:13}]},{columns:[{text:r.firstName,width:"25%"},{text:r.mobilePhone,width:"25%"},{text:r.personalEmail}]}])(null===e||void 0===e?void 0:e.filter((function(e){return e.id!==r.id&&e.familyHead===r.id})).forEach((function(e){return t.push([{columns:[{text:e.firstName,width:"25%"},{text:e.mobilePhone,width:"25%"},{text:e.personalEmail}]}])})))(n.content.push({stack:t,unbreakable:!0}))})),console.log(n),s().createPdf(n).download("damo.pdf")}(e)},children:"Export Congregation to PDF Contact List"}),(0,g.jsx)("div",{className:"m-4 bg-white p-4 text-center",onClick:function(){d("publishers","ord")},children:"Export Congregation to Orderly file"}),(0,g.jsx)("div",{className:"m-4 bg-white p-4 text-center",onClick:function(){d("publishers","csv")},children:"Export Congregation to CSV file"}),(0,g.jsx)(p,{})]})]})}}}]);
//# sourceMappingURL=348.94b765d1.chunk.js.map