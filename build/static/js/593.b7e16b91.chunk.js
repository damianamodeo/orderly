"use strict";(self.webpackChunkorderly=self.webpackChunkorderly||[]).push([[593],{593:function(e,t,n){n.r(t),n.d(t,{Settings:function(){return w}});var r=n(667),o=n(327),c=n(76),i=n(426),a=n(435),s=n.n(a),l=n(834);s().vfs=l.I.vfs;var u=function(e){return[Object.keys(e[1])].concat(e).map((function(e){return Object.values(e).toString()})).join("\r")},d=function(e,t){r.db.open().then((function(){!function(e,t,n,r){var o={},c=[t];if(0===c.size)r(null,"csv"===n?u(o[t]):JSON.stringify(o));else{var i=Array.from(c),a=e.transaction(i,"readonly");a.onerror=function(e){return r(e,null)},i.forEach((function(e){var c=[];a.objectStore(e).openCursor().onsuccess=function(a){var s=a.target.result;s?(c.push(s.value),s.continue()):(o[e]=c,i.length===Object.keys(o).length&&r(null,"csv"===n?u(o[t]):JSON.stringify(o)))}}))}}(r.db.backendDB(),e,t,(function(e,n){if(e)console.error(e);else{var r=new Date,o=String(r.getDate()).padStart(2,"0"),c=String(r.getMonth()+1).padStart(2,"0"),i=r.getFullYear(),a=new Blob([n],"csv"===t?{"text/csv":[".csv"]}:{"application/json":[".json"]}),s=URL.createObjectURL(a),l=Object.assign(document.createElement("a"),{href:s,style:"display:none",download:"publishers "+i+"-"+c+"-"+o+"."+t});document.body.appendChild(l),l.click(),URL.revokeObjectURL(s),l.remove()}}))})).catch((function(e){console.error("Could not connect. "+e)}))},f=n(841),h=n(328),b=n(184),x=function(e){var t=e.action,n=e.children;return(0,b.jsx)("div",{className:"dark:bg-buttonD w-56 text-center bg-button p-2 text-white dark:text-black m-auto",onClick:t,children:n})},p=function(e){var t=e.children;return(0,b.jsx)("span",{className:"text-black dark:text-white font-noto m-2",children:t})},m=n(885),g=n(791),v=function(e){var t=e.addStyle,n=e.children;return(0,b.jsx)("span",{className:"inline-block align-baseline dark:text-white "+t,children:n})},j=function(e){var t=e.id,n=(e.label,e.helpText),r=e.types,o=(0,g.useState)(n),c=(0,m.Z)(o,2),i=c[0],a=c[1];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{id:t,type:"file",accept:r,hidden:"hidden",onChange:function(e){a(e.target.value.match(/[/\\]([\w\d\s.\-()]+)$/)[1])}}),(0,b.jsxs)("div",{className:"my-3 flex flex-col content-center gap-5 text-center",children:[(0,b.jsx)(x,{action:function(){document.getElementById(t).click()},children:"Choose File"}),(0,b.jsx)(v,{children:i})]})]})},y=n(201);var k=function(e,t,n,r){var o=new Set(e.objectStoreNames);if(0===o.size)r(null);else{var c,i=Array.from(o),a=e.transaction(i,"readwrite");a.onerror=function(e){return alert("cb(event)")};var s=c="text/csv"===n?JSON.parse('{"publishers": '.concat(function(e){for(var t=e.split("\r"),n=[],r=t[0].split(","),o=1;o<t.length;o++){for(var c={},i=t[o].split(","),a=0;a<r.length;a++)"lastName"===r[a]?c[r[a]]=(0,y.L)(i[a]):"id"===r[a]||"familyHead"===r[a]?c[r[a]]=parseInt(i[a]):c[r[a]]=i[a];n.push(c)}return JSON.stringify(n)}(t),"}")):JSON.parse(t);console.log(c),Object.keys(s).forEach((function(e){i.includes(e)||delete s[e]})),0===Object.keys(s).length&&r(null),i.forEach((function(e){var t=0,n=Array.from(s[e]||[]);s[e]&&n.length>0?n.forEach((function(n){var o=a.objectStore(e).add(n);o.onsuccess=function(){++t===s[e].length&&(delete s[e],0===Object.keys(s).length&&r(null))},o.onerror=function(e){console.log(e)}})):s[e]&&(delete s[e],0===Object.keys(s).length&&r(null))}))}},S=function(e){var t=document.querySelector("#import-stores").files[0],n=new FileReader;n.onloadend=function(){console.log(t.type),function(e,t,n){var r=[t],o=r.size;if(0===o)n(null);else{var c=Array.from(r),i=e.transaction(c,"readwrite");i.onerror=function(e){return n(e)};var a=0;c.forEach((function(e){i.objectStore(e).clear().onsuccess=function(){++a===o&&n(null)}}))}}(r.db.backendDB(),e),k(r.db.backendDB(),n.result,t.type,(function(e){console.log(e)}))},n.readAsText(t)},w=function(){var e=(0,o.useLiveQuery)((function(){return r.db.publishers.orderBy("[lastName+firstName]").toArray()}));return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(c.h,{headerLeft:(0,b.jsx)("div",{}),title:(0,b.jsx)(h.X,{children:"Settings"}),headerRight:(0,b.jsx)("div",{className:"text-header text-primary"})}),(0,b.jsxs)(i.V,{bgColor:"bg-bgLightest dark:bg-black ",children:[(0,b.jsxs)(f.Z,{children:[(0,b.jsx)(p,{children:"Export Congregation"}),(0,b.jsxs)("div",{className:"my-3 flex flex-col content-center gap-8",children:[(0,b.jsx)(x,{action:function(){!function(e){var t,n={content:[],pageMargins:10};null===e||void 0===e||e.filter((function(e){return!e.familyHead||e.id===e.familyHead})).forEach((function(r){return t=[{svg:'<svg height="20" width="580"><line x1="0" y1="18" x2="580" y2="18" stroke="#4a6da7" style="stroke-width:2" /></svg>'},{columns:[{text:r.lastName.toUpperCase(),fontSize:18,bold:!0,width:"25%"},{text:r.homePhone,width:"25%"},{text:"".concat(r.unitNumber?"".concat(r.unitNumber,"/"):"").concat(r.houseNumber," ").concat(r.street,", ").concat(r.suburb),fontSize:13}]},{columns:[{text:r.firstName,width:"25%"},{text:r.mobilePhone,width:"25%"},{text:r.personalEmail}]}],null!==e&&void 0!==e&&e.filter((function(e){return e.id!==r.id&&e.familyHead===r.id})).forEach((function(e){return t.push([{columns:[{text:e.firstName,width:"25%"},{text:e.mobilePhone,width:"25%"},{text:e.personalEmail}]}])})),n.content.push({stack:t,unbreakable:!0})})),console.log(n),s().createPdf(n).download("damo.pdf")}(e)},children:"PDF"})," ",(0,b.jsx)(x,{action:function(){d("publishers","ord")},children:"ORD"})," ",(0,b.jsx)(x,{action:function(){d("publishers","csv")},children:"CSV"})]})]}),(0,b.jsxs)(f.Z,{children:[(0,b.jsx)(p,{children:"Import Congregation"}),(0,b.jsxs)("div",{className:"my-3 flex flex-col content-center gap-3",children:[(0,b.jsx)(j,{id:"import-stores",label:"",helpText:"Select a .csv or .ord file",types:".ord,.csv"}),(0,b.jsx)(x,{action:function(){S("publishers")},children:"Import"})]})]})]})]})}}}]);
//# sourceMappingURL=593.b7e16b91.chunk.js.map